# Spring Boot Starter для логирования HTTP-запросов
Spring-boot-starter-http-logging — это стартер для Spring Boot, который предоставляет мощное и настраиваемое решение для логирования HTTP-запросов и ответов в приложении Spring Boot. Он упрощает процесс отслеживания и отладки HTTP-коммуникаций,
предлагая гибкие возможности логирования, которые легко интегрируются в любое Spring Boot приложение.

## Функциональность
- Автоматическое логирование HTTP-запросов и ответов: Логирует основную информацию о входящих HTTP-запросах и исходящих ответах, включая заголовки, полезные данные и коды статуса.
- Настраиваемые уровни логирования: Позволяет настраивать уровень логирования (например, INFO, DEBUG, ERROR) для управления детализацией логов.
- Выборочное логирование: Включает или отключает логирование на основе различных условий, таких как HTTP-методы, конечные точки или коды статуса.
- Настраиваемый формат логов: Предоставляет возможности для настройки формата сообщений в логах.
- Обработка исключений: Захватывает и логирует исключения, которые происходят в процессе обработки HTTP-запросов.
- Легковесный и ненавязчивый: Разработан с минимальным воздействием на производительность приложения и может быть легко отключен при необходимости.

## Установка
Чтобы включить spring-boot-starter-http-logging в ваш проект, добавьте следующую зависимость в pom.xml:  
`<dependency>`  
    `<groupId>ru.t1.spring_boot_starter_http_logging</groupId>`  
    `<artifactId>spring-boot-starter-http-logging</artifactId>`  
    `<version>1.0.0</version>`  
`</dependency>`

### Конфигурация
Стартер может быть настроен с использованием следующих свойств в файле application.properties.

### Использование
После включения стартера в проект и правильной настройки, он автоматически будет логировать HTTP-запросы и ответы в соответствии с заданной конфигурацией.

### Базовое использование
По умолчанию, с минимальной конфигурацией, стартер будет логировать все HTTP-запросы и ответы на уровне INFO, включая заголовки и полезные данные.

## Структура
Стартер предоставляет следующие основные компоненты:
#### HttpLoggingInterceptor,  
который перехватывает HTTP-запросы и ответы для логирования.
### Ключевые методы:

- void logRequest(HttpServletRequest request): Логирует входящий HTTP-запрос.
- void logResponse(HttpServletRequest request, HttpServletResponse response): Логирует исходящий HTTP-ответ.
  
#### HttpLoggingAutoConfiguration
Класс конфигурации, который автоматически настраивает HttpLoggingInterceptor на основе свойств приложения.


## Тестирование
### Пример теста testLoggingInterceptor
В данном разделе описывается пример теста, демонстрирующего работу HttpLoggingInterceptor в приложении Spring Boot. Этот тест проверяет, что перехватчик корректно обрабатывает HTTP-запросы и ответы, а также логирует информацию в соответствии с настройками.


`@Test`  
`void testLoggingInterceptor() throws Exception {`  
    `// Создаем и настраиваем объект конфигурации логирования`  
    `HttpLoggingProperties properties = new HttpLoggingProperties();`  
    `properties.setEnabled(true);`

    // Создаем экземпляр перехватчика логирования с заданными настройками
    HttpLoggingInterceptor interceptor = new HttpLoggingInterceptor(properties);

    // Создаем имитацию HTTP-запроса
    MockHttpServletRequest request = new MockHttpServletRequest();
    request.setMethod("GET");
    request.setRequestURI("/test");

    // Создаем имитацию HTTP-ответа
    MockHttpServletResponse response = new MockHttpServletResponse();
    response.setStatus(200);

    // Выполняем предобработку запроса с помощью перехватчика
    interceptor.preHandle(request, response, new Object());

    // Выполняем завершение обработки запроса с помощью перехватчика
    interceptor.afterCompletion(request, response, new Object(), null);
}`

### Что проверяет этот тест?
- Создание конфигурации логирования: В тесте создается объект HttpLoggingProperties, который управляет поведением логирования. В данном случае, логирование включено с помощью properties.setEnabled(true).

- Инициализация перехватчика: Создается экземпляр HttpLoggingInterceptor, который принимает конфигурацию логирования в качестве параметра. Этот перехватчик будет использоваться для обработки и логирования HTTP-запросов и ответов.

- Имитирование HTTP-запроса и ответа: Для тестирования используется MockHttpServletRequest и MockHttpServletResponse. Запрос выполняется методом GET на URI /test, а ответ имеет статус 200 OK.

- Предобработка запроса: Метод preHandle перехватчика вызывается для имитации обработки входящего HTTP-запроса до того, как он достигнет конечной точки контроллера.

- Завершение обработки: Метод afterCompletion вызывается после завершения обработки запроса и отправки ответа. Этот этап используется для логирования окончательных данных и обработки возможных исключений.


## Заключение
spring-boot-starter-http-logging — это универсальное и настраиваемое решение для логирования HTTP-запросов и ответов в Spring Boot приложениях. С минимальной настройкой и широкими возможностями конфигурации он предоставляет мощный инструмент для разработчиков, который позволяет отслеживать и отлаживать HTTP-коммуникации в их приложениях.
